{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/api/serverApi.ts"],"sourcesContent":["import axios from \"axios\";\nimport { NextRequest } from \"next/server\";\nimport type { Note, NoteResponse } from \"../../types/note\";\nimport type { User } from \"../../types/user\";\n\nconst BASE_REMOTE = \"https://notehub-api.goit.study\";\n\nfunction createRemoteInstance(cookies?: string) {\n  return axios.create({\n    baseURL: BASE_REMOTE,\n    headers: {\n      Cookie: cookies ?? \"\",\n    },\n    withCredentials: true,\n  });\n}\n\ninterface FetchNotesParams {\n  page?: number;\n  perPage?: number;\n  search?: string;\n  tag?: string;\n}\n\n\nexport async function serverFetchNotes(req: NextRequest, params?: FetchNotesParams): Promise<NoteResponse> {\n  const inst = createRemoteInstance(req.headers.get(\"cookie\") ?? \"\");\n  const { data } = await inst.get<NoteResponse>(\"/notes\", { params });\n  return data;\n}\n\nexport async function checkSession(req: NextRequest): Promise<User | null> {\n  const inst = createRemoteInstance(req.headers.get(\"cookie\") ?? \"\");\n  const { data } = await inst.get<User>(\"/auth/session\");\n  return data || null;\n}\n\nexport async function getMe(req: NextRequest): Promise<User> {\n  const inst = createRemoteInstance(req.headers.get(\"cookie\") ?? \"\");\n  const { data } = await inst.get<User>(\"/users/me\");\n  return data;\n}\n\nexport async function serverFetchNoteById(req: NextRequest, id: string): Promise<Note> {\n  const inst = createRemoteInstance(req.headers.get(\"cookie\") ?? \"\");\n  const { data } = await inst.get<Note>(`/notes/${id}`);\n  return data;\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAKA,MAAM,cAAc;AAEpB,SAAS,qBAAqB,OAAgB;IAC5C,OAAO,wJAAK,CAAC,MAAM,CAAC;QAClB,SAAS;QACT,SAAS;YACP,QAAQ,WAAW;QACrB;QACA,iBAAiB;IACnB;AACF;AAUO,eAAe,iBAAiB,GAAgB,EAAE,MAAyB;IAChF,MAAM,OAAO,qBAAqB,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC/D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,GAAG,CAAe,UAAU;QAAE;IAAO;IACjE,OAAO;AACT;AAEO,eAAe,aAAa,GAAgB;IACjD,MAAM,OAAO,qBAAqB,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC/D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,GAAG,CAAO;IACtC,OAAO,QAAQ;AACjB;AAEO,eAAe,MAAM,GAAgB;IAC1C,MAAM,OAAO,qBAAqB,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC/D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,GAAG,CAAO;IACtC,OAAO;AACT;AAEO,eAAe,oBAAoB,GAAgB,EAAE,EAAU;IACpE,MAAM,OAAO,qBAAqB,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa;IAC/D,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,KAAK,GAAG,CAAO,CAAC,OAAO,EAAE,IAAI;IACpD,OAAO;AACT"}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { cookies } from 'next/headers';\nimport { parse } from 'cookie';\nimport { checkSession } from './lib/api/serverApi';\n\nconst privateRoutes = ['/profile'];\nconst publicRoutes = ['/sign-in', '/sign-up'];\n\nexport async function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const cookieStore = await cookies();\n  const accessToken = cookieStore.get('accessToken')?.value;\n  const refreshToken = cookieStore.get('refreshToken')?.value;\n\n  const isPublicRoute = publicRoutes.some(route => pathname.startsWith(route));\n  const isPrivateRoute = privateRoutes.some(route => pathname.startsWith(route));\n\n  if (!accessToken) {\n    if (refreshToken) {\n      try {\n        const data = await checkSession(request); \n        if (data) {\n\n          if (isPublicRoute) return NextResponse.redirect(new URL('/', request.url));\n          if (isPrivateRoute) return NextResponse.next();\n        }\n      } catch (err) {\n        console.error('Ошибка проверки сессии:', err);\n      }\n    }\n\n    if (isPublicRoute) return NextResponse.next();\n    if (isPrivateRoute) return NextResponse.redirect(new URL('/sign-in', request.url));\n  }\n\n  if (accessToken) {\n    if (isPublicRoute) return NextResponse.redirect(new URL('/', request.url));\n    if (isPrivateRoute) return NextResponse.next();\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: ['/profile/:path*', '/sign-in', '/sign-up'],\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;AAEA;;;;AAEA,MAAM,gBAAgB;IAAC;CAAW;AAClC,MAAM,eAAe;IAAC;IAAY;CAAW;AAEtC,eAAe,WAAW,OAAoB;IACnD,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,cAAc,MAAM,IAAA,sLAAO;IACjC,MAAM,cAAc,YAAY,GAAG,CAAC,gBAAgB;IACpD,MAAM,eAAe,YAAY,GAAG,CAAC,iBAAiB;IAEtD,MAAM,gBAAgB,aAAa,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IACrE,MAAM,iBAAiB,cAAc,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC;IAEvE,IAAI,CAAC,aAAa;QAChB,IAAI,cAAc;YAChB,IAAI;gBACF,MAAM,OAAO,MAAM,IAAA,+IAAY,EAAC;gBAChC,IAAI,MAAM;oBAER,IAAI,eAAe,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;oBACxE,IAAI,gBAAgB,OAAO,gMAAY,CAAC,IAAI;gBAC9C;YACF,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,2BAA2B;YAC3C;QACF;QAEA,IAAI,eAAe,OAAO,gMAAY,CAAC,IAAI;QAC3C,IAAI,gBAAgB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,YAAY,QAAQ,GAAG;IAClF;IAEA,IAAI,aAAa;QACf,IAAI,eAAe,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACxE,IAAI,gBAAgB,OAAO,gMAAY,CAAC,IAAI;IAC9C;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAmB;QAAY;KAAW;AACtD"}}]
}